<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <%= title %>
  </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <%- include("header") -%>

    <div class="container mt-5">
      <h1 class="display-4">
        <%= folder.name %>
      </h1>

      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="/folder/my-files">My Files</a>
          </li>
          <% folderPath.forEach((item, index)=> { %>
            <% if (index===folderPath.length - 1) { %>
              <li class="breadcrumb-item active" aria-current="page">
                <%= item.name %>
              </li>
              <% } else { %>
                <li class="breadcrumb-item">
                  <a href="<%= item.url %>">
                    <%= item.name %>
                  </a>
                </li>
                <% } %>
                  <% }); %>
        </ol>
      </nav>

      <!-- Buttons to trigger modals -->
      <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#createFolderModal">Create New
        Folder</button>
      <button class="btn btn-success mt-3" data-bs-toggle="modal" data-bs-target="#uploadFileModal">Upload File</button>

      <hr>
      <ul class="list-group">
        <% if (subfolders.length> 0 || files.length > 0) { %>

          <% subfolders.forEach(subfolder=> { %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <a class="text-decoration-none" href="/folder/<%= subfolder.id %>">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path fill="currentColor"
                    d="M4 20q-.825 0-1.412-.587T2 18V6q0-.825.588-1.412T4 4h6l2 2h8q.825 0 1.413.588T22 8v10q0 .825-.587 1.413T20 20z" />
                </svg>
                <%= subfolder.name %>
              </a>
            </li>
            <% }) %>

              <% files.forEach(file=> { %>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <span><strong>
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path fill="currentColor"
                          d="M13 9V3.5L18.5 9M6 2c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" />
                      </svg>
                      <%= file.name %>
                    </strong></span>
                  <a href="/uploads/<%= file.path.split('/').pop() %>" class="btn btn-link btn-sm"
                    target="_blank">Download</a>
                </li>
                <% }) %>

                  <% } else { %>
                    <li class="list-group-item">This folder is empty.</li>
                    <% } %>
      </ul>


      <hr>

      <!-- Create Folder Modal -->
      <div class="modal fade" id="createFolderModal" tabindex="-1" aria-labelledby="createFolderModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="createFolderModalLabel">Create a New Folder</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form action="/folder/create" method="POST">
                <div class="mb-3">
                  <label for="folderName" class="form-label">Folder Name</label>
                  <input type="text" class="form-control" id="folderName" name="name" required>
                  <input type="hidden" name="parentId" value="<%= folder.id %>">
                </div>
                <button type="submit" class="btn btn-primary">Create Folder</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Upload File Modal -->
      <div class="modal fade" id="uploadFileModal" tabindex="-1" aria-labelledby="uploadFileModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="uploadFileModalLabel">Upload a File</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form action="/file/upload" method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                  <label for="file" class="form-label">Choose a file</label>
                  <input type="file" class="form-control" id="file" name="file" required>
                  <input type="hidden" name="folderId" value="<%= folder.id %>">
                </div>
                <button type="submit" class="btn btn-success">Upload File</button>
              </form>
            </div>
          </div>
        </div>
      </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
